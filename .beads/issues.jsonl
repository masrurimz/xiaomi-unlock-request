{"id":"xiaomi-unlock-request-7ur","title":"Extract core.py: business logic with clock protocol","description":"All NTP, HTTP, timing, worker logic. Framework-agnostic (no Rich/Typer imports). Clock protocol for testable time control.","design":"CLOCK PROTOCOL: Protocol class with monotonic() and synced_now() methods. Production impl uses time.monotonic + NTP offset. Test impl returns controlled values.\nFUNCTIONS: sync_ntp(), check_status(), calc_target_time(), build_cookie(), gen_device_id(), parse_status_response(), parse_apply_response()\nASYNC: run_workers() takes clock + http_client as params for testability","acceptance_criteria":"- [ ] All business logic importable without Rich/Typer\n- [ ] Clock protocol allows injecting fake time\n- [ ] check_status() returns typed result (not bool + print)\n- [ ] run_workers() accepts injected client + clock\n- [ ] Tests in test_core.py pass","status":"closed","priority":1,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:42.817275+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:39.965095+07:00","closed_at":"2026-02-22T00:03:39.965095+07:00","close_reason":"core.py: Clock protocol, all business logic, typed results","dependencies":[{"issue_id":"xiaomi-unlock-request-7ur","depends_on_id":"xiaomi-unlock-request-qzc","type":"blocks","created_at":"2026-02-21T23:36:53.261323+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-7ur","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.66345+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-8ut","title":"CLI UX Overhaul: Typer + Rich interactive CLI","description":"Rewrite xiaomi-unlock-request from single-file raw ANSI script into modern interactive CLI with Typer + Rich. Subcommands: setup, status, run. Live countdown, spinners, worker table, results panel. Full test suite.","design":"FRAMEWORK: Typer + Rich (oracle-validated choice over Cyclopts/Click)\nSTRUCTURE: src/xiaomi_unlock/ package with 4 modules (cli.py, core.py, ui.py, config.py)\nENTRY: mi-unlock via [project.scripts]\nSUBCOMMANDS: setup (token wizard), status (quick check), run (full AQLR flow)\nDEPS: typer\u003e=0.15, rich\u003e=13, httpx\u003e=0.27, ntplib\u003e=0.4\nDEV DEPS: pytest\u003e=8, pytest-asyncio\u003e=0.24, respx\u003e=0.22\nTESTING: Clock protocol for deterministic time tests, respx for HTTP mocking\nUI: Rich spinners (NTP/status), Rich Live countdown (HH:MM:SS), Rich Table (worker status), Rich Panel (results + next steps)\nFLAGS: --dry-run, --plain (line-based output)","acceptance_criteria":"- [ ] uv run mi-unlock setup → interactive token wizard saves tokens.json\n- [ ] uv run mi-unlock status → checks account eligibility with spinner\n- [ ] uv run mi-unlock run → full flow with live countdown + worker table\n- [ ] uv run mi-unlock run --dry-run → runs everything except HTTP POST\n- [ ] uv run mi-unlock run --plain → line-based output (no Rich Live)\n- [ ] pytest passes with \u003e80% coverage on core.py and config.py\n- [ ] Old unlock.py deleted\n- [ ] README updated with new usage","notes":"[2026-02-22 00:40] STEP: Planning complete, beads created with dependency graph\nRESULT: Epic + 7 child tasks with blocks dependencies. Oracle validated Typer+Rich choice.\nTRACE: bd create x7, bd dep add x14, oracle consulted\nPLAN: Scaffold → Config+Core+UI (parallel-ready) → CLI → Tests → Cleanup\nDECISIONS: Typer+Rich over Cyclopts (ecosystem maturity), src layout, clock protocol for testing\nNEXT: Handoff to worker thread for implementation (all 7 tasks sequential)","status":"closed","priority":0,"issue_type":"epic","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:14.436714+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:23.201424+07:00","closed_at":"2026-02-22T00:03:23.201427+07:00"}
{"id":"xiaomi-unlock-request-93q","title":"Extract config.py: token management + validation","description":"Token load/save/validate logic. Support tokens.json (new) and token.txt (legacy compat). Interactive setup wizard with Rich prompts.","acceptance_criteria":"- [ ] load_tokens() reads tokens.json or token.txt\n- [ ] save_tokens() writes tokens.json with chmod 600\n- [ ] validate_token() checks non-empty, reasonable length\n- [ ] setup_wizard() interactive Rich prompts for Firefox + Chrome tokens\n- [ ] Tests in test_config.py pass","status":"closed","priority":1,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:42.731228+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:40.04497+07:00","closed_at":"2026-02-22T00:03:40.04497+07:00","close_reason":"config.py: load/save/validate tokens, setup_wizard","dependencies":[{"issue_id":"xiaomi-unlock-request-93q","depends_on_id":"xiaomi-unlock-request-qzc","type":"blocks","created_at":"2026-02-21T23:36:53.181312+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-93q","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.575444+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-c8q","title":"Scaffold project: src layout + pyproject.toml + deps","description":"Restructure from flat unlock.py to src/xiaomi_unlock/ package. Update pyproject.toml with Typer+Rich deps, dev deps, console_scripts entry point, pytest config.","acceptance_criteria":"- [ ] src/xiaomi_unlock/__init__.py exists\n- [ ] src/xiaomi_unlock/cli.py, core.py, ui.py, config.py exist (can be stubs)\n- [ ] pyproject.toml has all runtime + dev deps\n- [ ] [project.scripts] mi-unlock = xiaomi_unlock.cli:app\n- [ ] uv sync succeeds\n- [ ] uv run mi-unlock --help shows subcommands","notes":"COMPLETED: Scaffold started. DECISION: Switching from Typer to Click based on librarian research - Click is user's existing pattern (pse-scraper), both frameworks have identical async/Rich Live behavior, Click is more mature. pyproject.toml updated.","status":"closed","priority":0,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:20.816427+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:40.124357+07:00","closed_at":"2026-02-22T00:03:40.124357+07:00","close_reason":"Scaffold: src layout, pyproject.toml Click+Rich deps","dependencies":[{"issue_id":"xiaomi-unlock-request-c8q","depends_on_id":"xiaomi-unlock-request-93q","type":"blocks","created_at":"2026-02-21T23:36:52.933847+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-c8q","depends_on_id":"xiaomi-unlock-request-7ur","type":"blocks","created_at":"2026-02-21T23:36:53.014953+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-c8q","depends_on_id":"xiaomi-unlock-request-crc","type":"blocks","created_at":"2026-02-21T23:36:53.09801+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-c8q","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.494415+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-crc","title":"Build ui.py: Rich display components","description":"Rich UI components: NTP spinner, status panel, live countdown, worker status table, results panel, next-steps panel.","acceptance_criteria":"- [ ] ntp_spinner() context manager with Rich spinner\n- [ ] status_panel() renders account status as Rich Panel\n- [ ] countdown_display() Rich Live with updating HH:MM:SS\n- [ ] worker_table() Rich Table with per-worker status\n- [ ] results_panel() Rich Panel with approval/failure + next steps\n- [ ] All components accept data from core.py (no HTTP calls)","status":"closed","priority":1,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:42.901955+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:39.886992+07:00","closed_at":"2026-02-22T00:03:39.886992+07:00","close_reason":"ui.py: ntp_spinner, status_panel, countdown_display, worker_table, results_panel","dependencies":[{"issue_id":"xiaomi-unlock-request-crc","depends_on_id":"xiaomi-unlock-request-qzc","type":"blocks","created_at":"2026-02-21T23:36:53.337391+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-crc","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.746511+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-flj","title":"Xiaomi 15 bootloader unlock via AQLR","description":"Clean Python implementation of AQLR method for Xiaomi bootloader unlock. 4 parallel requests at midnight Beijing time with staggered offsets.","notes":"COMPLETED: Audited original AQLR files (5 Python files, all clean, no malware). Rewrote as clean asyncio script using httpx+ntplib. Set up uv project. NEXT: Get browser tokens from c.mi.com/global, put in token.txt, run at midnight Beijing time.","status":"open","priority":0,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:29:30.401998+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-21T23:29:30.401998+07:00","dependencies":[{"issue_id":"xiaomi-unlock-request-flj","depends_on_id":"xiaomi-unlock-request-8ut","type":"related","created_at":"2026-02-21T23:36:53.571963+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-qzc","title":"Wire cli.py: Typer subcommands + integration","description":"Typer app with 3 subcommands: setup, status, run. Wires core.py + ui.py together. Flags: --dry-run, --plain, --token-file.","acceptance_criteria":"- [ ] mi-unlock setup → runs token wizard from config.py\n- [ ] mi-unlock status → calls core.check_status, renders with ui.status_panel\n- [ ] mi-unlock run → full AQLR flow with live UI\n- [ ] mi-unlock run --dry-run → skips actual POST\n- [ ] mi-unlock run --plain → falls back to line-based output\n- [ ] --help shows all commands with descriptions","status":"closed","priority":1,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:42.987596+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:39.810348+07:00","closed_at":"2026-02-22T00:03:39.810348+07:00","close_reason":"cli.py: Click group, setup/status/run subcommands","dependencies":[{"issue_id":"xiaomi-unlock-request-qzc","depends_on_id":"xiaomi-unlock-request-w26","type":"blocks","created_at":"2026-02-21T23:36:53.417143+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-qzc","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.83114+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-t80","title":"Cleanup: delete unlock.py, update README","description":"Remove old unlock.py, update README with new CLI usage, verify e2e.","acceptance_criteria":"- [ ] unlock.py deleted\n- [ ] README shows mi-unlock setup/status/run usage\n- [ ] uv run mi-unlock --help works\n- [ ] git commit with all changes","status":"closed","priority":2,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:43.161692+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:23.125747+07:00","closed_at":"2026-02-22T00:03:23.125747+07:00","close_reason":"unlock.py deleted, README updated with new mi-unlock usage","dependencies":[{"issue_id":"xiaomi-unlock-request-t80","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.992859+07:00","created_by":"Muhammad Zahid Masruri"}]}
{"id":"xiaomi-unlock-request-w26","title":"Write test suite","description":"pytest tests for core logic, config, and worker behavior. Use respx for HTTP mocking, fake clock for time control.","acceptance_criteria":"- [ ] test_config.py: load/save/validate tokens, missing file, legacy format\n- [ ] test_core.py: device_id, cookie, timing calcs, status parsing, apply parsing\n- [ ] test_worker.py: retry on 100001, stop on approval, timeout, quota reached\n- [ ] All tests pass: uv run pytest\n- [ ] No real HTTP calls or real sleeps in tests","status":"closed","priority":1,"issue_type":"task","owner":"masruri03@gmail.com","created_at":"2026-02-21T23:36:43.074676+07:00","created_by":"Muhammad Zahid Masruri","updated_at":"2026-02-22T00:03:28.440341+07:00","closed_at":"2026-02-22T00:03:28.440341+07:00","close_reason":"32 tests passing","dependencies":[{"issue_id":"xiaomi-unlock-request-w26","depends_on_id":"xiaomi-unlock-request-t80","type":"blocks","created_at":"2026-02-21T23:36:53.493389+07:00","created_by":"Muhammad Zahid Masruri"},{"issue_id":"xiaomi-unlock-request-w26","depends_on_id":"xiaomi-unlock-request-8ut","type":"parent-child","created_at":"2026-02-21T23:37:00.913014+07:00","created_by":"Muhammad Zahid Masruri"}]}
